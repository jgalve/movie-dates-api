<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha256-YLGeXaapI0/5IgZopewRJcFXomhRMlYYjugPLSyNjTY=" crossorigin="anonymous" />

    <link href="https://fonts.googleapis.com/css?family=Lato:400,900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Oswald&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.standalone.min.css" integrity="sha256-jO7D3fIsAq+jB8Xt3NI5vBf3k4tvtHwzp8ISLQG4UWU=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" integrity="sha256-PHcOkPmOshsMBC+vtJdVr5Mwb7r0LkSVJPlPrp/IMpU=" crossorigin="anonymous" />

    <title>MOVIE RELEASE DATES</title>
</head>

<style>
    body {background: #252525;}
    a:hover {text-decoration: none;}
    p {line-height: 20px; color: #fff;}
    .btn {box-shadow: none !important;}
    h1 {color: #f78926; font-family: 'Oswald', sans-serif;  text-shadow: 2px 2px 3px #000; font-size: 85px;}
    .title {font-weight: bold; font-size: 25px; line-height: 27px; border-bottom: 1px solid #909090; padding: 2px 0px 7px 0px; margin-bottom: 5px;}
    .release-date {font-size: 15px; font-style: italic;}
    .search-bar {align-items: center;  padding: 0px 15px; display: flex; flex-direction: row;
        height: auto;}
    .centered {align-content:center; height: calc(100vh - 0px); flex-direction: column;justify-content: center; background: rgba(0,0,0,0.7); background: radial-gradient(circle, rgba(121,121,121,0.6) 0%, rgba(0,0,0,1,0.6) 100%);}
    #datepicker {background: #000000;
        color: #d0b141;
        border: 4px dotted #000;
        animation: borderFlash 2s infinite;
        font-weight: bold;
        font-size: 23px;
        padding: 5px;
        letter-spacing: 5px;
        line-height: 14px;
        box-shadow: none !important;
        height: 45.5px;}
    #submit {padding: 10px 17px; 
        font-weight: bold;
        background: #00ffb8;
        border: #00ffb8;
        color: #2f2f2f;
        }
    #imdb {background: rgba(0, 0, 0, 0.7); padding: 0px 25px;}
    .main-container {background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
    }
    .movie-box {display:inline-block; vertical-align: top; width: 33.333%;padding: 0px 15px; margin: 20px 0px;}
    .poster {    width: 100%;
        background: #000;
        min-height: 200px;
        padding-left: 0px;
        box-shadow: 1px 1px 2px #000;
        display: flex;
        justify-content: center;
        align-items: center;
        padding-right: 0px;}
    .now-showing {margin-bottom: 20px; margin-top: 30px;}
    .now-showing .list {
        display: inline-block;
        margin: 15px;
        width: 240px;
        text-align: center;
        vertical-align: top;
    }
    .now-showing h3 {margin: 10px 15px; font-size: 19px;
        color: #fff;}
    .now-showing h3 a {color: #00feb7;}
    .bottom {background: rgba(0, 0, 0, 0.9);}
    .bottom .btn {background: #000 !important;
        border: 1px solid #fff !important;}
    .bottom .btn:hover {border-color: #00ffb8 !important; color: #00ffb8 !important;}

    .dateResult {font-size: 26px;
        display: none;
        background: rgba(0,0,0,0.9);
        padding: 15px;
        margin-bottom: 0px;}

    @keyframes borderFlash {
        50% {
           border-color: #d0b141;
           box-shadow: 0px 0px 7px #d0b141;
        }
     }
</style>

<body>
    <main class="main-container">

        <!-- SEARCH GROUP INITIAL -->
        <div class="search-bar centered animated fadeIn delay-1s slow" id="search-bar">
            <div class="pt-1 text-center">
                <a href="./index.php"><h1 class="ml-3 mr-3 main-title">MOVIE RELEASE DATES</h1></a>
            </div>

            <form class="form-inline text-center align-items-center justify-content-center">
                <input type="text" class="form-control mr-2 text-center" id="datepicker" value="" placeholder="Enter a date" required />
                <button type="submit" id="submit" class="btn btn-primary ">SEARCH</button>
            </form>

            <section class="now-showing animated zoomInDown slow clear-fix">
                <h3>NOW SHOWING: <a href="" class="text-right btn-nowshowing">VIEW ALL &raquo;</a></h3>   
            </section>

        </div>

        <p class="text-center dateResult">Showing movies for "<i></i>"</p>

        <!-- SEARCH RESULTS -->
        <div id="imdb" data-page="1">
            
        </div>

        <!-- BOTTOM BUTTONS -->
        <div class="text-center px-3 py-3 bottom d-none">
            <button class="btn btn-primary btn-showmore mx-2"> SHOW MORE </button>
            <a href="#search-bar" class="btn btn-primary btn-backsearch mx-2">BACK TO TOP</a>
        </div>

    </main>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha256-bqVeqGdJ7h/lYPq6xrPv/YGzMEb6dNxlfiTUHSgRCp8=" crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha256-CjSoeELFOcH0/uxWu6mC/Vlrc1AARqbm/jiiImDGV3s=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        $(document).ready(function () {

            initialize();

            //get url params
            function getParams() {
                var url = window.location.href;
                var releaseParam = url.split('=');
                releaseParam.shift();
                console.log('releaseParam: ' + releaseParam)

                if (url.indexOf('?release=') > 0 ) {
                    $('#datepicker').val(releaseParam);
                    console.log('datepicker' + $('#datepicker').val());

                    getMovie(releaseParam);
                } else {
                    setToday();
                    //$('#datepicker').val('');
                }
            };

            //set date today
            function setToday() {
                //set date today
                let today = new Date().toISOString().substr(0, 10);
                document.querySelector("#datepicker").value = today;
                console.log('today is ' + today);

                return today;
            }
   
            //datepicker
            $('#datepicker').datepicker({format: "yyyy-mm-dd"});
            $('#datepicker').on('changeDate', function() {
                $(this).val(
                    $(this).datepicker('getFormattedDate')
                );
                //$('#imdb').empty();
                console.log("datepicker: " + $(this).val());
            });

            //click now showing
            $('.btn-nowshowing').on('click', function(e) {
                e.preventDefault();
                getMovie(setToday());
            })

            //submit button imdb
            $('#submit').on('click', function (e) {
                e.preventDefault();
                
                $('#imdb').attr('data-page', '1');

                removeInitialize();

                var releaseDate = $('#datepicker').val();
                getMovie(releaseDate);
            });

            //remove initial style {
            function removeInitialize() {
                $('.search-bar').removeClass('centered').css({
                    'background': 'rgba(0, 0, 0, 0.8)',
                    'height': '80px'
                });
                $('.main-container').css({
                    'background-repeat':'repeat-y',
                    'background-size':'100%',
                    'background-position':'center top',
                    'padding-bottom' : '0px'
                });
                
                $('#imdb').empty().css('min-height', 'calc(100vh - 60px)');
                
                $('.now-showing').hide();
                $('.bottom').removeClass('d-none');  
            }


            // get movie
            function getMovie(releaseDate) {
                console.log('getMovie!!!!')

                if ($('.centered').length > 0) {
                    removeInitialize();
                };

                //show results bar
                $('.dateResult').fadeIn(300);
                $('.dateResult i').text(releaseDate);

                //var releaseDate = $('#datepicker').val();
                var page = $('#imdb').attr('data-page');
                $('.main-title').css({
                    'font-size': '52px',
                    'margin-bottom': '8px',
                    'margin-right': '35px !important'
                });
                
                $.ajax({
                    dataType: 'json',
                    async: true,
                    url: "https://api.themoviedb.org/4/discover/movie?page=1&include_video=true&include_adult=true&sort_by=release_date.desc&language=en-US&api_key=c4a7e818fe724bcddb380f1c88cb8464&release_date.lte=" + releaseDate + '&page=' + page,
                    success: function (discover, status) {
                        console.log("releaseDate: " + releaseDate);
                        console.log(discover);
                        
                        for (i = 0; i < discover.results.length; i++) {
                            $('#imdb').append(
                                '<section class="movie-box animated fadeIn slow">' +
                                    '<div class=\"row\">' +
                                        '<div class="col-lg-6 col-sm-6 col-xs-12 pl-0 pr-0">' +
                                            '<div class="poster">' +
                                                '<img class="img-fluid" src=\"https://image.tmdb.org/t/p/w342' + discover.results[i].poster_path + '\" />' +
                                            '</div>' +
                                        '</div>' +
                                        '<div class="col-lg-6 col-sm-6 col-xs-12 pr-4 movie-details">' +
                                            '<p class=\"title\">' + discover.results[i].original_title + '</p>' +
                                            '<p class=\"release-date\"><b>RELEASE DATE:</b> ' + discover.results[i].release_date + '</p>' +
                                            '<p class=\"overview\"><b>OVERVIEW:</b> ' + discover.results[i].overview + '</p>' +
                                        '</div>' +
                                    '</div>' +
                                '</section>'
                            );  
                        };

                        window.history.replaceState(null, null, "?release=" + releaseDate);
                        //$('#datepicker').val('');

                    },
                    error: function(status) {
                        alert('error: ' + status);
                    }
                });
            };

            //initial movie
            function initialize() {
                console.log('initialize!!!!')
                getParams();

                var releaseDate = $('#datepicker').val();

                $.ajax({
                    dataType: 'json',
                    async: true,
                    url: "https://api.themoviedb.org/4/discover/movie?page=1&include_video=true&include_adult=true&sort_by=popularity.desc&language=en-US&api_key=c4a7e818fe724bcddb380f1c88cb8464&release_date.lte=" + releaseDate,
                    success: function (discover, status) {                      
                       
                        //now showing
                        $.ajax({
                            dataType: 'json',
                            async: true,
                            url: "https://api.themoviedb.org/4/discover/movie?page=1&include_video=true&include_adult=true&sort_by=release_date.desc&language=en-US&api_key=c4a7e818fe724bcddb380f1c88cb8464&release_date.lte=" + releaseDate,
                            success: function (discover, status) {                      
                               
                                for (i = 0; i < 4; i++) {
                                    $('.now-showing').append(
                                        '<div class="list">' +
                                            '<img class="img-fluid" src=\"https://image.tmdb.org/t/p/w342' + discover.results[i].poster_path + '\" />' +
                                            '<p class=\"title\">' + discover.results[i].original_title + '</p>' +
                                            '<p class=\"release-date\"><b>RELEASE DATE:</b> ' + discover.results[i].release_date + '</p>' +
                                        '</div>'
                                    );  
                                };

                                //wallpaper
                                var shuffle = Math.floor(Math.random() * 10)
                                for (i = 0; i < discover.results.length; i++) {
                                    $('.main-container').css('background-image', 'url(\"https://image.tmdb.org/t/p/original' + discover.results[shuffle].poster_path + '\")');
                                };

                            }
                        });


                    },
                    error: function(status) {
                        alert('error: ' + status);
                    }
                });
            };

            //next page
            $('.btn-showmore').on('click', function(e) {
                e.preventDefault();
                var page = $('#imdb').attr('data-page');
                page = Number(page);
                page = page + 1;
                $('#imdb').attr('data-page', page);
                //alert('current page' + $('#imdb').attr('data-page'));

                var releaseDate = $('#datepicker').val();
                getMovie(releaseDate);
            });

            //scroll top
            $('.btn-backsearch').on('click', function(e) {
                e.preventDefault();
                $(window).scrollTop(0);
            });

            // get credits
            function getCredits() {
                //var creditId = discover.results.id;
                
                $.ajax({
                    dataType: 'json',
                    url: "https://api.themoviedb.org/4/credit/&api_key=9afcbfc4caf1d317295d6506444725ca" + creditId,
                    success: function (credit, status) {
                        console.log("creditId: " + credit);
                        console.log(credit);
                        
                        for (i = 0; i < credit.results.length; i++) {
                            $('.movie-details').append(
                                '<p><b>RELEASE DATE:<\/b> ' + credit.credit_type + '</p>'
                            );
                        }
                    },
                    error: function(status) {
                        console.log('error: ' + status);
                    }
                });
            };
        });

    </script>

</body>

</html>